{% load static %}
<!doctype html>
<html lang="en">
{% include 'expendable/head.html' %}

<body id="top">
{% include 'expendable/chatbot_and_loading.html' %}

<div class="site-wrap">
    <!-- NAVBAR -->
    {% include 'expendable/navbar.html' %}

    <section class="section-hero overlay inner-page bg-image"
             style="background-image: url('{% static "images/hero_1.jpg" %}');" id="home-section">
        <div class="container">
            <div class="row">
                <div class="col-md-7">
                    <h1 class="text-white font-weight-bold">Edit Blog</h1>
                    <div class="custom-breadcrumbs">
                        <a href="{% url 'homepage' %}">Home</a> <span class="mx-2 slash">/</span>
                        <a href="{% url 'blog' %}">Blogs</a> <span class="mx-2 slash">/</span>
                        <span class="text-white"><strong>Edit Blog</strong></span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Blog Edit Form -->
    <form class="p-5 p-md-5 border rounded bg-white shadow-lg" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <h3 class="text-center text-dark mb-5 border-bottom pb-4 display-4 font-weight-bold">Edit Your Blog</h3>

        <div class="form-group mb-4 mr-5 ml-5">
            <label for="blog-title" class="h5 font-weight-bold">Blog Title</label>
            <input type="text" class="form-control form-control-lg border-0 shadow-sm rounded" name="title"
                   id="blog-title" value="{{ blog.title }}" placeholder="Enter a catchy blog title" required>
        </div>

        <div class="form-group mb-4 mr-5 ml-5">
            <label for="blog-photo" class="h5 font-weight-bold">Upload Blog Photo</label><br>
            <label class="btn btn-primary btn-md btn-file shadow-sm rounded-pill"
                   style="width: 300px; text-align: center;">
                <i class="fas fa-upload"></i> Browse File
                <input type="file" name="photo" id="blog-photo" hidden onchange="showFileName(); previewImage(event);">
            </label>
            <span id="file-name" class="ml-3 text-muted">{{ blog.photo.name }}</span>
            <!-- Image Preview -->
            <div id="image-preview" style="margin-top: 20px;">
                <img id="uploaded-image" src="{{ blog.photo.url }}" alt="Uploaded Image"
                     style="max-width: 100%; height: 300px; object-fit: cover; border: 2px solid #ccc; padding: 5px; border-radius: 5px;">
            </div>
        </div>

        <div class="form-group mb-4 mr-5 ml-5">
            <label for="content" class="h5 font-weight-bold">Blog Content</label>
            <textarea class="form-control form-control-lg border-0 shadow-sm rounded" name="content" id="editor-1"
                      placeholder="Write your blog content here..." rows="10" required>{{ blog.content }}</textarea>
        </div>

        <div class="form-group mb-4 mr-5 ml-5">
            <label for="new-tags" class="h5 font-weight-bold">Tags (Enter tags separated by commas)</label>
            <input type="text" class="form-control form-control-lg border-0 shadow-sm rounded" name="new_tags"
                   id="new-tags"
                   value="
                           {% for tag in blog.tags.all %}{{ tag.name }}{% if not forloop.last %}, {% endif %}{% endfor %}"
                   placeholder="eg. uiu, google, facebook" required>
        </div>

        <div class="form-group mb-4 mr-5 ml-5">
            <label for="email" class="h5 font-weight-bold">Email (Author)</label>
            <input type="email" class="form-control form-control-lg border-0 shadow-sm rounded" name="email"
                   value="{{ user.email }}" readonly required>
        </div>

        <div class="form-group mb-4 mr-5 ml-5">
            <label for="time_date" class="h5 font-weight-bold">Publish Date & Time</label>
            <input type="text" class="form-control form-control-lg border-0 shadow-sm rounded" id="time_date"
                   name="time_date" value="{{ blog.updated_at }}" readonly required>
        </div>

        <button type="submit" class="btn btn-success btn-lg btn-block shadow-lg rounded-pill mt-4 mr-5">
            <i class="fas fa-paper-plane"></i> Save Changes
        </button>

        <script>
            CKEDITOR.replace('editor-1');

            function previewImage(event) {
                var reader = new FileReader();
                reader.onload = function () {
                    var output = document.getElementById('uploaded-image');
                    output.src = reader.result;
                }
                reader.readAsDataURL(event.target.files[0]);
            }
        </script>
    </form>
    {% include 'expendable/footer.html' %}
</div>

{% include 'expendable/include.html' %}
</body>
</html>
