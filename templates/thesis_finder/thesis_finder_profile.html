{% load static %}
<!doctype html>
<html lang="en">
{% include 'expendable/head.html' %}

<body id="top">
{% include 'expendable/chatbot_and_loading.html' %}

<div class="site-wrap">

    <div class="site-mobile-menu site-navbar-target">
        <div class="site-mobile-menu-header">
            <div class="site-mobile-menu-close mt-3">
                <span class="icon-close2 js-menu-toggle"></span>
            </div>
        </div>
        <div class="site-mobile-menu-body"></div>
    </div> <!-- .site-mobile-menu -->


    <!-- NAVBAR -->
    {% include 'expendable/navbar.html' %}
    <!-- HOME -->
    <section class="section-hero overlay inner-page bg-image"
             style="background-image: url('{% static "images/hero_1.jpg" %}');"
             id="home-section">
        <div class="container">
            <div class="row">
                <div class="col-md-7">
                    <h1 class="text-white font-weight-bold">Edit My Thesis Profile</h1>
                    <div class="custom-breadcrumbs">
                        <a href="#">Home</a> <span class="mx-2 slash">/</span>
                        <a href="{% url 'thesis_finder' %}">Thesis Finder</a> <span class="mx-2 slash">/</span>
                        <span class="text-white"><strong>Edit My Thesis Profile</strong></span>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <div class="container mt-5 mb-5 col-sm-8">
        <div class="form-container">
            <h2 class="text-center mb-4">Edit Your Profile</h2>
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}

                <!-- Full Name -->
                <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input type="text" class="form-control" id="name" name="name"
                           value="{{ user.name }}" placeholder="Enter your full name" required>
                </div>

                <!-- Email (Read-only) -->
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}"
                           placeholder="Enter your email" readonly>
                </div>

                <!-- Department -->
                <div class="form-group">
                    <label for="department">Department</label>
                    <select class="form-control" id="department" name="department" required>
                        <option value="" disabled selected>Select your department</option>
                        <option value="Computer Science & Engineering"
                                {% if user.department == "Computer Science & Engineering" %}selected{% endif %}>Computer
                            Science & Engineering
                        </option>
                        <option value="Electrical and Electronics Engineering"
                                {% if user.department == "Electrical and Electronics Engineering" %}selected{% endif %}>
                            Electrical and Electronics Engineering
                        </option>
                        <option value="Civil Engineering"
                                {% if user.department == "Civil Engineering" %}selected{% endif %}>Civil Engineering
                        </option>
                        <option value="Business Administration"
                                {% if user.department == "Business Administration" %}selected{% endif %}>Business
                            Administration
                        </option>
                        <option value="Media and Journalism"
                                {% if user.department == "Media and Journalism" %}selected{% endif %}>Media and
                            Journalism
                        </option>
                        <option value="Pharmacy" {% if user.department == "Pharmacy" %}selected{% endif %}>Pharmacy
                        </option>
                    </select>
                </div>

                <!-- University ID -->
                <div class="form-group">
                    <label for="university_id">University ID</label>
                    <input type="text" class="form-control" id="university_id" name="university_id"
                           value="{{ user.university_id }}" placeholder="Enter your university ID"
                           pattern="0[0-9]{0,9}"
                           title="University ID must start with 0 and have a maximum of 10 digits."
                           maxlength="10" required>
                </div>


                <!-- Skills -->
                <div class="form-group">
                    <label for="skills">Skills</label>
                    <textarea class="form-control" id="skills" name="skills" rows="3" placeholder="Enter your skills"
                              required>{{ user.skills }}</textarea>
                </div>

                <!-- Research Interests -->
                <div class="form-group">
                    <label for="research_interests">Research Interests</label>
                    <textarea class="form-control" id="research_interests" name="research_interests" rows="3"
                              placeholder="Enter your research interests"
                              required>{{ user.research_interests }}</textarea>
                </div>

                <!-- Thesis Supervisor -->
                <div class="form-group">
                    <label for="thesis_supervisor">Thesis Supervisor (Expected)</label>
                    <input type="text" class="form-control" id="thesis_supervisor" name="thesis_supervisor"
                           value="{{ user.thesis_supervisor }}" placeholder="Enter thesis supervisor's name">
                </div>

                <!-- Profile Picture -->
                <!-- Profile Picture -->
                <div class="form-group">
                    <label for="profile_picture">Profile Picture</label>
                    <input type="file" class="form-control-file" id="profile_picture" name="profile_picture"
                           accept="image/*" onchange="confirmImageChange()">
                    {% if user.profile_picture %}
                        <img src="{{ user.profile_picture.url }}" alt="Profile Picture" class="img-fluid mt-2"
                             style="max-width: 150px;" id="profilePicturePreview">
                    {% endif %}
                </div>

                <script>
                    function confirmImageChange() {
                        const fileInput = document.getElementById('profile_picture');
                        const previewImage = document.getElementById('profilePicturePreview');

                        // Check if the user has selected a new file
                        if (fileInput.files.length > 0) {
                            const newFile = fileInput.files[0];
                            const userConfirmed = confirm("Uploading a new image will replace the existing one. Do you want to proceed?");

                            if (userConfirmed) {
                                // Create a URL for the selected file and update the image preview
                                const reader = new FileReader();
                                reader.onload = function (e) {
                                    previewImage.src = e.target.result; // Show the new image
                                };
                                reader.readAsDataURL(newFile);
                            } else {
                                // Reset the file input if the user cancels
                                fileInput.value = '';
                            }
                        }
                    }
                </script>

                <!-- Availability -->
                <div class="form-group">
                    <label for="availability">Availability</label>
                    <select class="form-control" id="availability" name="availability" required>
                        <option value="True" {% if user.availability %}selected{% endif %}>Available for new
                            collaborations
                        </option>
                        <option value="False" {% if not user.availability %}selected{% endif %}>Not available for new
                            collaborations
                        </option>
                    </select>
                </div>

                <!-- Contact Information -->
                <div class="form-group">
                    <label for="contact_info">Contact Information</label>
                    <input type="text" class="form-control" id="contact_info" name="contact_info"
                           value="{{ user.contact_info }}" placeholder="Enter your contact info (phone, etc.)"
                           pattern="01[0-9]{0,9}" title="Phone number must start with 01 and be up to 11 digits long."
                           maxlength="11" required>
                </div>

                <!-- Thesis Topic -->
                <div class="form-group">
                    <label for="thesis_topic">Thesis Topic (Expected)</label>
                    <textarea class="form-control" id="thesis_topic" name="thesis_topic" rows="3"
                              placeholder="Enter your thesis topic">{{ user.thesis_topic }}</textarea>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn btn-primary btn-block">Save Changes</button>
            </form>

            <!-- Delete Profile Button -->
            <form method="POST" action="{% url 'thesis_finder_profile_delete' %}" class="mt-3">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger btn-block"
                        onclick="return confirm('Are you sure you want to delete the profile?')">Delete Profile
                </button>
            </form>
        </div>
    </div>
    {% include 'expendable/footer.html' %}
</div>
{% include 'expendable/include.html' %}

</body>
</html>